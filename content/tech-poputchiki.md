+++
Categories = []
Description = ""
Keywords = []
Tags = []
date = "2014-10-27T21:15:54+03:00"
title = "Попутчики"
+++

Описание инфраструктуры
=========================

## Серверная часть проекта
Для реализации проекта "Попутчики" (далее "проект") выбран компилируемый, 
многопоточный язык программирования (далее "ЯП") Go (часто также Golang, далее "Go"), 
разработанный компанией Google. 

### Техническое обоснование выбора Go

#### Высокая производительность
По сравнению с ЯП Python, который рассматривался как ЯП для проекта, 
Go производительнее в 20 раз по данным Яндекс, где он также использовался 
в качестве основного ЯП для проектов. С PHP ситуация аналогичная. 
На задачах Яндекс, Go оказался всего лишь в 2 раза медленней Java или С++,
что является отличным результатом, учитывая сложность разработки под эти языки, 
другие минусы их использования и то, что в основном эти языки выбираются за их
скорость выполнения.

#### Скорость разработки и безопасность
Так как Go компилируемый, реорганизация кода и выявление ошибок производится быстрее, 
чем с интерптерируемыми ЯП (Python, PHP)

#### Простота 
Язык Go очень прост, его полная спецификация составляет десятки страниц,
что по сравнению с Java (где их сотни) довольно мало (как и по сравнению с Python).
Изучение Go с нуля производится быстро, Яндекс, например, часто переучивает специалистов
с Python на Go, не выполняя найм конкретно на зарработчика Go

#### Популярность
Go успешно используется в таких команиях, как Яндекс и Google, а так же в Dropbox, Heroku, CloudFlare, Bitbucket, Docker, Iron.io, MaxCDN, Mozilla Services, New York Times, Secret, SoundCloud, Twitch, Tumblr, Sourcegraph и идеально подходит для написания REST API, серверов конвертации и вообще серверной части для веб-приложений.

### Составные части серверной части проекта
Серверная часть проекта состоит из двух частей, REST API (далее "api") и сервер конвертации.

#### API
Api обрабатывает запросы от клиентов (браузера и смартфонов), 
выплняет вычисления в соответсвии с бизнес-логикой приложения, связываясь с базой данных, серверами кеширования и внешними ресурсами (например, сервис оплаты или социальные сети, сервер конвертации) и отправляет ответ, результаты которого отображаются на клиенте.

API реализует RESTful сервис, используя протокол http и  

#### Сервер конвертации
Сервер конвертации - сервис, отвечающий за конвертацию изображений, аудио и видео файлов в подходящие форматы и сохранение их в облачное хранилище. 
Такие вычисления являются очень требовательны к ресурсам, поэтому выполняются не в API, а делегируются. 
Сервер конвертации обычно запущен в нескольких экземплярах, что позволяет выполнять балансировку загрузки, также он может быть физически
отделен от API для того, чтобы нагрузка на него не влияла на работспособность и скорость работы API.

Для общения между API и серверами конвертации выбран Redis - сетевое журналируемое хранилище данных типа «ключ — значение», которое позволяет
с легкостью реализовать очередь выполнения для задач конвертации.

## Инфраструктурная часть проекта
Специально для проекта была разработана инфраструктура, основанная на операционной системе CoreOS. Схему см. в приложении.

Инфраструктура позволяет практически неограниченно горизонтально масштабировать проект, начиная от десятков, заканчивая десятками тысяч пользователей, обеспечивая высокий уровень доступности и надежности, используя минимальное количество ресурсов. Это достигается за счет использования некоторых передовых технологий и подходов к разработке и серверному администрированию которые будут описаны далее.

### Nginx
В качестве веб сервера, реверс-прокси сервера, балансировщика нагрузки и сервера для статических файлов был выбран nginx - простой, быстрый и надёжный сервер. 

Nginx позволяет использовать протокол SPDY и модуль PageSpeed от Google, основной задачей которых является снижение времени загрузки веб-страниц и их элементов.

### Docker
Docker — программное обеспечение для автоматизации развёртывания и управления приложениями в среде виртуализации на уровне операционной системы LXC. Позволяет «упаковать» приложение со всем его окружением и зависимостями в контейнер, который может быть перенесён на любой Linux-системе с поддержкой cgroups в ядре, а также предоставляет среду по управлению контейнерами. Написан на языке Go.

Эта технология позволяет избавиться от разрешения конфликтов зависимостей и максимально приближает условия тестирования к боевым, т.е. практически устраняет различия между тем, как проект выполняется на тестовом, staging сервере и на боевом сервере. 

Очень облегчает обновление, тестирование, разработку и развертывание.

### CoreOS
CoreOS — легковесная операционная система с открытым исходным кодом на базе ядра Linux. Предназначена для создания инфраструктуры компьютерных кластеров, особое внимание уделено автоматизации, упрощению внедрения приложений, безопасности, надежности и масштабируемости. В качестве операционной системы CoreOS предоставляет лишь минимальную функциональность, необходимую для развертывания приложений внутри программных контейнеров Docker, средства обнаружения сервисов и передачи настроек.

Предоставляет удобный интерфейс по управлению контейнерами Docker, автоматизируя уже разрешение зависимостей между самими контейнерами 
(например, сервер конвертации требует etcd) и позволяя производить настройку автоматически (ip адреса контейнеров с MongoDB, Redis можно с легкостью получать через единый интерфейс). 

Также CoreOS предоставляет возможность динамически конфигурировать nginx — добавлять и удалять балансировщики переднего края (с автоматическим изменением DNS записей) и балансировщики для API (с автоматическим изменением конфигурации балансировщиков переднего края, масштабироваться и преодолевать физическую недоступность серверов без простоя)


### MongoDB

MongoDB — документо-ориентированная система управления базами данных (СУБД) с открытым исходным кодом, не требующая описания схемы таблиц.
Выбор этой БД обусловен легкостью решения проблемы горизонтального масштабирования и ускорению разработки приложения за счет отсутствия схемы.